<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cosmic Payment Gateway</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    
    <!-- Impor Three.js -->
    <script type="importmap">
    {
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.164.1/build/three.module.js"
        }
    }
    </script>

    <style>
        :root {
            --glow-color: #0ea5e9; /* sky-500 */
        }
        body {
            font-family: 'Roboto', sans-serif;
            color: #E0E0E0;
            background-color: #02040a;
            overflow: hidden;
        }
        h1, h2, h3, .font-orbitron {
            font-family: 'Orbitron', sans-serif;
        }

        /* Canvas untuk latar belakang 3D Three.js */
        #three-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }

        /* Efek glassmorphism utama */
        .glass-panel {
            background: rgba(15, 23, 42, 0.65);
            backdrop-filter: blur(16px) saturate(180%);
            -webkit-backdrop-filter: blur(16px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 0 25px rgba(0,0,0,0.3), 0 0 40px rgba(var(--glow-color), 0.2);
            transition: opacity 0.5s ease, transform 0.5s ease;
        }
        
        .main-panel.hidden {
            opacity: 0;
            transform: scale(0.95) translateY(20px);
            pointer-events: none;
        }

        /* Gaya tab */
        .tab-btn {
            transition: all 0.3s ease;
            text-shadow: 0 0 8px rgba(var(--glow-color), 0.7);
        }
        .tab-btn.active {
            background: rgba(14, 165, 233, 0.25);
            color: #f0f9ff;
            border-bottom-color: var(--glow-color);
            box-shadow: 0 2px 15px -5px rgba(var(--glow-color), 0.5);
        }
        .tab-btn:not(.active):hover {
            background: rgba(14, 165, 233, 0.1);
            border-bottom-color: rgba(var(--glow-color), 0.5);
        }

        /* Tombol dan elemen interaktif */
        .method-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            text-shadow: 0 0 3px rgba(0,0,0,0.5);
        }
        .method-btn:hover {
            background: rgba(14, 165, 233, 0.3);
            border-color: var(--glow-color);
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 0 20px rgba(var(--glow-color), 0.6);
        }
        .method-btn.active {
            background: var(--glow-color);
            color: #02040a;
            font-weight: 700;
            border-color: var(--glow-color);
            box-shadow: 0 0 25px rgba(var(--glow-color), 0.8), 0 0 50px rgba(var(--glow-color), 0.5);
            transform: translateY(-2px);
        }
        
        /* Animasi */
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }
        .animate-fadeIn { animation: fadeIn 1s ease-out forwards; }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-slideUp { animation: slideUp 0.7s ease-out forwards; }
        
        @keyframes pulseGlow {
            0%, 100% { box-shadow: 0 0 20px rgba(var(--glow-color), 0.6); }
            50% { box-shadow: 0 0 35px rgba(var(--glow-color), 1); }
        }
        .animate-pulseGlow { animation: pulseGlow 2.5s infinite; }

        /* Area Chat AI */
        .chat-container {
            height: 400px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 12px;
            padding: 15px;
            background: rgba(2, 6, 23, 0.7);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .chat-message {
            max-width: 85%;
            padding: 12px 18px;
            border-radius: 18px;
            line-height: 1.5;
            word-wrap: break-word;
            opacity: 0;
            transform: translateY(10px);
            animation: slideUp 0.4s ease forwards;
        }
        .chat-message.user {
            background: linear-gradient(135deg, #0ea5e9, #0284c7);
            color: #fff;
            align-self: flex-end;
            border-bottom-right-radius: 4px;
        }
        .chat-message.ai {
            background: #334155; /* slate-700 */
            color: #E0E0E0;
            align-self: flex-start;
            border-bottom-left-radius: 4px;
        }
        .chat-input {
            border: 1px solid #475569;
            background-color: #1e293b;
        }
        .chat-input:focus {
            border-color: var(--glow-color);
            box-shadow: 0 0 0 2px rgba(var(--glow-color), 0.5);
        }
        
        /* Indikator pengetikan AI */
        .loading-dots span {
            display: inline-block;
            width: 9px;
            height: 9px;
            margin: 0 3px;
            background-color: #94a3b8;
            border-radius: 50%;
            animation: bounce 1.4s infinite ease-in-out both;
        }
        .loading-dots span:nth-child(1) { animation-delay: -0.32s; }
        .loading-dots span:nth-child(2) { animation-delay: -0.16s; }
        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1.0); }
        }

        /* Avatar AI */
        #ai-avatar {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            cursor: pointer;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.4s ease;
        }
        #ai-avatar::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(14, 165, 233, 0.8) 0%, rgba(15, 23, 42, 0.5) 70%);
            animation: pulseGlow 3s infinite, rotateGlow 10s linear infinite;
            box-shadow: 0 0 15px rgba(var(--glow-color), 0.5), 0 0 30px rgba(var(--glow-color), 0.3);
        }
        #ai-avatar:hover {
            transform: scale(1.1);
        }
        #ai-avatar i {
            font-size: 2rem;
            color: #f0f9ff;
            text-shadow: 0 0 10px #fff;
            z-index: 1;
        }
        @keyframes rotateGlow {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Tombol Mute */
        #mute-btn {
            position: fixed;
            top: 1.5rem;
            right: 1.5rem;
            width: 45px;
            height: 45px;
            z-index: 1000;
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #94a3b8;
        }
        #mute-btn:hover {
            background: rgba(14, 165, 233, 0.2);
            color: #fff;
        }
    </style>
</head>
<body class="bg-slate-950">

    <canvas id="three-canvas"></canvas>
    
    <audio id="ambient-sound" loop>
        <source src="https://files.catbox.moe/l2b3o6.mp3" type="audio/mpeg">
    </audio>
    
    <button id="mute-btn" class="rounded-full flex items-center justify-center transition-all duration-300">
        <i id="mute-icon" class="fas fa-volume-off"></i>
    </button>

    <div id="ai-avatar" title="Buka Panel">
        <i class="fas fa-satellite-dish"></i>
    </div>

    <div class="min-h-screen w-full flex items-center justify-center p-4">
        <main id="main-panel" class="w-full max-w-2xl glass-panel rounded-2xl overflow-hidden animate-fadeIn main-panel">
            <header class="p-6 border-b border-slate-700/50 text-center relative">
                <div class="absolute top-4 left-4 text-xs text-sky-400 opacity-70">
                    <i class="fas fa-signal"></i> STATUS: SECURE
                </div>
                <img src="https://files.catbox.moe/4ya0zn.jpg" alt="Profil Developer" class="w-24 h-24 rounded-full mx-auto border-4 border-slate-700 shadow-lg mb-4 ring-2 ring-sky-500/50 hover:ring-sky-400 transition-all duration-300">
                <h1 class="text-3xl font-bold tracking-wider text-white">COSMIC PAYMENT</h1>
                <p class="text-sm text-slate-400 mt-1">Gateway Pembayaran Futuristik oleh MiwaaGOD</p>
            </header>

            <nav class="flex bg-slate-900/50 border-b-2 border-slate-800">
                <button id="dashboard-tab" class="tab-btn active flex-1 p-4 text-base sm:text-lg font-orbitron border-b-4 border-transparent">
                    <i class="fas fa-tachometer-alt mr-2"></i>Dashboard
                </button>
                 <button id="contact-tab" class="tab-btn flex-1 p-4 text-base sm:text-lg font-orbitron border-b-4 border-transparent">
                    <i class="fas fa-user-astronaut mr-2"></i>Hubungi Dev
                </button>
                <button id="ai-assistant-tab" class="tab-btn flex-1 p-4 text-base sm:text-lg font-orbitron border-b-4 border-transparent">
                    <i class="fas fa-robot mr-2"></i>AI Asisten
                </button>
            </nav>

            <div class="relative">
                <div id="dashboard-view" class="p-6 sm:p-8">
                    <div class="animate-slideUp">
                        <div class="flex justify-center gap-4 mb-6">
                            <button data-type="ewallet" class="payment-type-btn method-btn active px-5 py-2 rounded-lg"><i class="fas fa-wallet mr-2"></i>E-Wallet</button>
                            <button data-type="qris" class="payment-type-btn method-btn px-5 py-2 rounded-lg"><i class="fas fa-qrcode mr-2"></i>QRIS</button>
                        </div>
                        <div id="ewallet-view">
                            <div class="grid grid-cols-3 gap-3 mb-6">
                                <button data-method="dana" class="ewallet-method-btn method-btn p-3 rounded-lg text-center text-lg">DANA</button>
                                <button data-method="gopay" class="ewallet-method-btn method-btn p-3 rounded-lg text-center text-lg">GOPAY</button>
                                <button data-method="ovo" class="ewallet-method-btn method-btn p-3 rounded-lg text-center text-lg">OVO</button>
                            </div>
                            <div class="bg-slate-900/70 rounded-lg p-5 text-center min-h-[120px] flex flex-col justify-center items-center border border-slate-700">
                                <div id="placeholder" class="text-slate-400">
                                    <i class="fas fa-arrow-up text-2xl"></i>
                                    <p class="mt-2">Pilih metode pembayaran</p>
                                </div>
                                <div id="details" class="hidden w-full">
                                    <p class="text-sm text-slate-300">Silakan transfer ke <span id="method-name" class="font-bold text-sky-300"></span>:</p>
                                    <div class="flex items-center justify-center gap-4 mt-2">
                                        <p id="payment-number" class="text-2xl sm:text-3xl font-orbitron text-sky-300"></p>
                                        <button id="copy-btn" title="Salin Nomor" class="bg-sky-500 text-slate-900 w-10 h-10 rounded-full text-lg hover:bg-sky-400 active:bg-sky-600 transition-all duration-200 flex items-center justify-center shadow-lg hover:shadow-sky-400/50">
                                            <i class="far fa-copy"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="qris-view" class="hidden text-center">
                             <p class="text-slate-300 mb-4">Pindai kode QR di bawah ini.</p>
                             <div class="max-w-xs mx-auto bg-white p-3 rounded-lg border-4 border-sky-400 shadow-2xl shadow-sky-500/30 animate-pulseGlow">
                                 <img src="https://files.catbox.moe/x5ixxt.jpeg" alt="Kode QRIS Pembayaran" class="w-full h-auto rounded-md">
                             </div>
                        </div>
                    </div>
                </div>
                
                <div id="contact-view" class="p-6 sm:p-8 hidden">
                    <div class="text-center animate-slideUp">
                        <h2 class="text-2xl font-orbitron mb-6 text-sky-300">Hubungi Developer</h2>
                        <div class="flex flex-col sm:flex-row justify-center items-center gap-4">
                            <a href="https://wa.me/628174731245" target="_blank" rel="noopener noreferrer" class="method-btn w-full sm:w-auto flex items-center justify-center px-6 py-3 rounded-lg text-lg">
                                <i class="fab fa-whatsapp text-2xl mr-3 text-green-400"></i> WhatsApp
                            </a>
                            <a href="https://t.me/miwasogg" target="_blank" rel="noopener noreferrer" class="method-btn w-full sm:w-auto flex items-center justify-center px-6 py-3 rounded-lg text-lg">
                                <i class="fab fa-telegram text-2xl mr-3 text-sky-400"></i> Telegram
                            </a>
                        </div>
                    </div>
                </div>

                <div id="ai-assistant-view" class="p-6 sm:p-8 hidden">
                    <h2 class="text-2xl font-orbitron mb-4 text-sky-300 text-center">MIWA AI Assistant</h2>
                    <div id="chat-container" class="chat-container"></div>
                    <div class="mt-4 flex gap-3">
                        <input type="text" id="chat-input" class="chat-input flex-grow p-3 rounded-full outline-none" placeholder="Tanya MIWA AI...">
                        <button id="send-chat-btn" class="bg-sky-500 text-slate-900 w-12 h-12 rounded-full text-lg hover:bg-sky-400 active:bg-sky-600 transition-all duration-200 flex items-center justify-center shadow-lg hover:shadow-sky-400/50 animate-pulseGlow">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div id="notification" class="fixed bottom-8 left-1/2 -translate-x-1/2 glass-panel py-2 px-5 rounded-full text-white transition-all duration-500 opacity-0 -translate-y-10 pointer-events-none">
        <i class="fas fa-check-circle text-green-400 mr-2"></i>Nomor berhasil disalin!
    </div>

    <script type="module">
        import * as THREE from 'three';

        document.addEventListener('DOMContentLoaded', () => {
            // --- Inisialisasi Audio ---
            const ambientSound = document.getElementById('ambient-sound');
            const muteBtn = document.getElementById('mute-btn');
            const muteIcon = document.getElementById('mute-icon');
            let isMuted = true;

            const clickSound = new Audio('https://files.catbox.moe/bgsif3.mp3');
            clickSound.volume = 0.5;
            const aiResponseSound = new Audio('https://files.catbox.moe/i5we15.mp3');
            aiResponseSound.volume = 0.4;
            
            function playClickSound() {
                clickSound.currentTime = 0;
                clickSound.play().catch(e => {});
            }

            function toggleMute() {
                isMuted = !isMuted;
                ambientSound.muted = isMuted;
                muteIcon.className = isMuted ? 'fas fa-volume-off' : 'fas fa-volume-up';
                if (!isMuted && ambientSound.paused) {
                    ambientSound.play().catch(e => console.log("Audio play failed. User interaction needed."));
                }
            }
            muteBtn.addEventListener('click', toggleMute);
            // Coba putar audio setelah interaksi pertama
            document.body.addEventListener('click', () => {
                if (!isMuted && ambientSound.paused) {
                    ambientSound.play().catch(e => {});
                }
            }, { once: true });


            // --- Latar Belakang 3D Three.js ---
            let scene, camera, renderer, stars;
            let mouseX = 0, mouseY = 0;

            function initThree() {
                const canvas = document.getElementById('three-canvas');
                scene = new THREE.Scene();
                camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 1, 1000);
                camera.position.z = 1;
                
                renderer = new THREE.WebGLRenderer({ canvas, antialias: true });
                renderer.setSize(window.innerWidth, window.innerHeight);
                renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));

                const starGeo = new THREE.BufferGeometry();
                const starCount = 20000;
                const positions = new Float32Array(starCount * 3);
                for(let i=0; i < starCount * 3; i++) {
                    positions[i] = (Math.random() - 0.5) * 800;
                }
                starGeo.setAttribute('position', new THREE.BufferAttribute(positions, 3));
                
                const starMaterial = new THREE.PointsMaterial({
                    color: 0xffffff,
                    size: 0.7,
                    transparent: true,
                    opacity: 0.8
                });

                stars = new THREE.Points(starGeo, starMaterial);
                scene.add(stars);

                window.addEventListener('resize', onWindowResize);
                document.addEventListener('mousemove', onMouseMove);
                animate();
            }

            function onWindowResize() {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            }

            function onMouseMove(event) {
                mouseX = event.clientX - window.innerWidth / 2;
                mouseY = event.clientY - window.innerHeight / 2;
            }

            function animate() {
                requestAnimationFrame(animate);
                const t = Date.now() * 0.0001;
                stars.rotation.y = t * 0.5;
                
                camera.position.x += (mouseX * 0.0001 - camera.position.x) * 0.05;
                camera.position.y += (-mouseY * 0.0001 - camera.position.y) * 0.05;
                camera.lookAt(scene.position);

                renderer.render(scene, camera);
            }

            initThree();

            // --- Logika UI ---
            const mainPanel = document.getElementById('main-panel');
            const aiAvatar = document.getElementById('ai-avatar');
            const tabs = document.querySelectorAll('.tab-btn');
            const views = {
                'dashboard-tab': document.getElementById('dashboard-view'),
                'contact-tab': document.getElementById('contact-view'),
                'ai-assistant-tab': document.getElementById('ai-assistant-view')
            };
            const paymentTypeBtns = document.querySelectorAll('.payment-type-btn');
            const ewalletView = document.getElementById('ewallet-view');
            const qrisView = document.getElementById('qris-view');
            const ewalletMethodBtns = document.querySelectorAll('.ewallet-method-btn');
            const detailsContainer = {
                placeholder: document.getElementById('placeholder'),
                details: document.getElementById('details'),
                methodName: document.getElementById('method-name'),
                paymentNumber: document.getElementById('payment-number')
            };
            const copyBtn = document.getElementById('copy-btn');
            const notification = document.getElementById('notification');
            
            const paymentData = {
                dana: { name: "DANA", number: "08174731245" },
                gopay: { name: "GOPAY", number: "08174731245" },
                ovo: { name: "OVO", number: "08174731245" }
            };
            let activeMethod = null;

            aiAvatar.addEventListener('click', () => {
                mainPanel.classList.toggle('hidden');
                playClickSound();
            });

            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    playClickSound();
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    Object.values(views).forEach(v => v.classList.add('hidden'));
                    views[tab.id].classList.remove('hidden');
                });
            });

            paymentTypeBtns.forEach(btn => btn.addEventListener('click', () => {
                playClickSound();
                paymentTypeBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                ewalletView.classList.toggle('hidden', btn.dataset.type !== 'ewallet');
                qrisView.classList.toggle('hidden', btn.dataset.type !== 'qris');
            }));

            ewalletMethodBtns.forEach(btn => btn.addEventListener('click', () => {
                playClickSound();
                activeMethod = btn.dataset.method;
                const data = paymentData[activeMethod];
                detailsContainer.methodName.textContent = data.name;
                detailsContainer.paymentNumber.textContent = data.number;
                detailsContainer.placeholder.classList.add('hidden');
                detailsContainer.details.classList.remove('hidden');
                ewalletMethodBtns.forEach(b => b.classList.toggle('active', b.dataset.method === activeMethod));
            }));

            copyBtn.addEventListener('click', () => {
                playClickSound();
                if (!activeMethod) return;
                navigator.clipboard.writeText(paymentData[activeMethod].number).then(() => {
                    showNotification();
                });
            });

            function showNotification() {
                notification.classList.remove('opacity-0', '-translate-y-10');
                notification.classList.add('opacity-100', 'translate-y-0');
                setTimeout(() => {
                    notification.classList.add('opacity-0', '-translate-y-10');
                    notification.classList.remove('opacity-100', 'translate-y-0');
                }, 2500);
            }

            // --- Logika AI Assistant (MIWA) ---
            const chatContainer = document.getElementById('chat-container');
            const chatInput = document.getElementById('chat-input');
            const sendChatBtn = document.getElementById('send-chat-btn');
            
            const CHAT_HISTORY_KEY = 'miwa_chat_history';
            let chatHistory = [];

            // Sistem prompt untuk memberikan kepribadian pada AI
            const systemPrompt = {
                role: "system",
                parts: [{ text: "Anda adalah MIWA, asisten AI futuristik untuk Cosmic Payment Gateway. Anda ramah, canggih, dan sangat membantu. Selalu jawab dalam Bahasa Indonesia. Fokus pada pertanyaan seputar pembayaran, status transaksi, dan cara penggunaan gateway. Jika ditanya di luar topik, dengan sopan kembalikan percakapan ke topik pembayaran." }]
            };

            function loadChatHistory() {
                const storedHistory = localStorage.getItem(CHAT_HISTORY_KEY);
                if (storedHistory) {
                    chatHistory = JSON.parse(storedHistory);
                    chatHistory.forEach(msg => {
                        if (msg.role !== 'system') {
                            addMessageToChat(msg.parts[0].text, msg.role === 'user' ? 'user' : 'ai', false);
                        }
                    });
                } else {
                    chatHistory = [systemPrompt];
                    addMessageToChat("Halo! Saya MIWA, asisten AI Anda. Ada yang bisa saya bantu terkait pembayaran?", 'ai', false);
                }
            }

            function saveChatHistory() {
                localStorage.setItem(CHAT_HISTORY_KEY, JSON.stringify(chatHistory));
            }

            function addMessageToChat(message, sender, animate = true) {
                const messageElement = document.createElement('div');
                messageElement.classList.add('chat-message', sender);
                if (!animate) {
                    messageElement.style.opacity = 1;
                    messageElement.style.transform = 'translateY(0)';
                }
                messageElement.textContent = message;
                chatContainer.appendChild(messageElement);
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }

            function showLoadingIndicator() {
                const loadingElement = document.createElement('div');
                loadingElement.id = 'loading-indicator';
                loadingElement.classList.add('chat-message', 'ai', 'loading-dots');
                loadingElement.innerHTML = '<span></span><span></span><span></span>';
                chatContainer.appendChild(loadingElement);
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }

            function hideLoadingIndicator() {
                document.getElementById('loading-indicator')?.remove();
            }

            async function sendMessageToGemini() {
                const prompt = chatInput.value.trim();
                if (prompt === '') return;

                playClickSound();
                addMessageToChat(prompt, 'user');
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                chatInput.value = '';
                
                showLoadingIndicator();

                // =================================================================
                // PANDUAN BACKEND: Implementasi Middleware & Keamanan API
                // =================================================================
                // Di aplikasi Next.js, Anda akan membuat file `middleware.ts` di root.
                // Middleware ini akan mencegat request ke API routes (`/api/*`).
                //
                // Contoh `middleware.ts`:
                // import { NextRequest, NextResponse } from 'next/server';
                // import { Ratelimit } from '@upstash/ratelimit';
                // import { kv } from '@vercel/kv';
                //
                // const ratelimit = new Ratelimit({ redis: kv, limiter: Ratelimit.slidingWindow(5, '10s') });
                //
                // export async function middleware(request: NextRequest) {
                //   const ip = request.ip ?? '127.0.0.1';
                //   const { success } = await ratelimit.limit(ip);
                //   if (!success) {
                //     return new NextResponse('Rate limit exceeded', { status: 429 });
                //   }
                //
                //   // Di sini Anda juga akan melakukan validasi HMAC signature untuk webhook,
                //   // validasi timestamp, dan cek token JWT jika ada.
                //
                //   return NextResponse.next();
                // }
                //
                // export const config = {
                //   matcher: '/api/:path*',
                // };
                // =================================================================

                try {
                    const payload = { contents: chatHistory };
                    const apiKey = ""; // Otomatis diisi oleh Canvas
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    const result = await response.json();
                    hideLoadingIndicator();
                    aiResponseSound.play().catch(e => {});

                    if (result.candidates?.[0]?.content?.parts?.[0]?.text) {
                        const aiResponse = result.candidates[0].content.parts[0].text;
                        addMessageToChat(aiResponse, 'ai');
                        chatHistory.push({ role: "model", parts: [{ text: aiResponse }] });
                        saveChatHistory();
                    } else {
                        addMessageToChat("Maaf, terjadi gangguan kosmik. Saya tidak bisa merespons saat ini.", 'ai');
                    }
                } catch (error) {
                    console.error('Error calling Gemini API:', error);
                    hideLoadingIndicator();
                    addMessageToChat("Koneksi ke nebula AI terputus. Silakan coba lagi.", 'ai');
                }
            }

            sendChatBtn.addEventListener('click', sendMessageToGemini);
            chatInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') sendMessageToGemini();
            });

            // Inisialisasi
            document.querySelector('[data-type="ewallet"]').classList.add('active');
            document.querySelector('[data-method="dana"]').classList.add('active');
            activeMethod = 'dana';
            detailsContainer.methodName.textContent = paymentData.dana.name;
            detailsContainer.paymentNumber.textContent = paymentData.dana.number;
            detailsContainer.placeholder.classList.add('hidden');
            detailsContainer.details.classList.remove('hidden');
            
            loadChatHistory();
        });
    </script>
</body>
</html>
